(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-13",authoriseHeader:{authorization:"f465fb02-51a8-4242-b3a2-1fc5d06a9ddb"},headers:{authorization:"f465fb02-51a8-4242-b3a2-1fc5d06a9ddb","Content-Type":"application/json"}};function t(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var n=document.querySelector("#card-template").content;function o(e,t,o,r){var c=n.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__delete-button"),u=c.querySelector(".card__like-button"),i=c.querySelector(".card__image"),s=c.querySelector(".card__title"),l=c.querySelector(".card__like-button-quantity");return s.textContent=e.name,i.src=e.link,i.alt=e.name,l.textContent=e.likes.length,c.id=e._id,r?a.addEventListener("click",(function(){r(e._id)})):a.style.display="none",u.addEventListener("click",(function(){return t(u,e._id,l)})),i.addEventListener("click",(function(){return o(e.name,e.link)})),c}function r(n,o,r){var c;n.classList.contains("card__like-button_is-active")?(c=o,fetch("".concat(e.baseUrl,"/cards/likes/").concat(c),{method:"DELETE",headers:e.authoriseHeader}).then((function(e){return t(e)}))).then((function(e){r.textContent=e.likes.length,n.classList.remove("card__like-button_is-active")})).catch((function(e){console.log("Ошибка выполнения запроса к серверу - ".concat(e))})):function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:e.authoriseHeader}).then((function(e){return t(e)}))}(o).then((function(e){r.textContent=e.likes.length,n.classList.add("card__like-button_is-active")})).catch((function(e){console.log("Ошибка выполнения запроса к серверу - ".concat(e))}))}function c(e){e.classList.add("popup_is-opened"),window.addEventListener("keyup",u)}function a(e){e.classList.remove("popup_is-opened"),window.removeEventListener("keyup",u)}function u(e){"Escape"===e.key&&a(document.querySelector(".popup_is-opened"))}function i(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled","")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",""))}function s(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelectorAll(".form__input-error");n.forEach((function(e){e.classList.remove(t.inputErrorClass)})),o.forEach((function(e){e.classList.remove(t.errorClass),e.textContent=""}))}var l,d,p=document.querySelector(".places__list"),_=document.querySelectorAll(".popup"),f=document.querySelector(".popup_type_edit-avatar"),m=document.querySelector(".popup_type_confirm"),v=document.querySelector(".popup_type_edit"),y=document.querySelector(".popup_type_new-card"),h=document.querySelector(".popup_type_image"),b=document.querySelector(".popup__caption"),S=document.querySelector(".popup__image"),q=document.querySelector(".popup__button[name=save-avatar]"),C=document.querySelector(".popup__button[name=save-profile]"),L=document.querySelector(".popup__button[name=save-card]"),E=document.querySelector(".profile__avatar-button"),k=document.querySelector(".popup__button[name=confirm]"),g=document.querySelector(".profile__edit-button"),x=document.querySelector(".profile__add-button"),A=document.querySelector(".profile__description"),B=document.querySelector(".profile__avatar"),T=document.querySelector(".profile__title"),U=document.querySelector(".popup__form[name=edit-profile]"),w=document.querySelector(".popup__input[name=name]"),H=document.querySelector(".popup__input[name=description]"),P=document.querySelector(".popup__form[name=new-place]"),D=document.querySelector(".popup__input[name=place-name]"),N=document.querySelector(".popup__input[name=addLink]"),O=document.querySelector(".popup__form[name=new-avatar]"),j=document.querySelector(".popup__input[name=avatar-link]"),I={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function J(e,t){S.src=t,S.alt=e,b.textContent=e,c(h)}function M(e){c(m),l=e}!function(e){e.forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){return a(e)})),e.addEventListener("click",(function(t){t.target.classList.contains("popup")&&a(e)}))}))}(_),E.addEventListener("click",(function(){c(f),s(f,I)})),g.addEventListener("click",(function(){c(v),w.value=T.textContent,H.value=A.textContent,s(v,I)})),x.addEventListener("click",(function(){c(y),s(y,I)})),k.addEventListener("click",(function(){return n=l,o=document.getElementById(n),void function(n){return fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:e.authoriseHeader}).then((function(e){return t(e)}))}(n).then((function(){o.remove(),a(m)})).catch((function(e){console.log("Ошибка выполнения запроса к серверу - ".concat(e))}));var n,o})),O.addEventListener("submit",(function(n){var o;n.preventDefault(),q.textContent="Сохранение...",(o=j.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then((function(e){return t(e)}))).then((function(){B.style.backgroundImage="url(".concat(j.value,")"),a(f),j.value="",q.classList.add(I.inactiveButtonClass),q.setAttribute("disabled","")})).catch((function(e){console.log("Ошибка выполнения запроса к серверу - ".concat(e))})).finally((function(){setTimeout((function(){q.textContent="Сохранить"}),1e3)}))})),U.addEventListener("submit",(function(n){var o,r;n.preventDefault(),C.textContent="Сохранение...",(o=w.value,r=H.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:o,about:r})}).then((function(e){return t(e)}))).then((function(){T.textContent=w.value,A.textContent=H.value,a(v),C.classList.add(I.inactiveButtonClass),C.setAttribute("disabled","")})).catch((function(e){console.log("Ошибка выполнения запроса к серверу - ".concat(e))})).finally((function(){setTimeout((function(){C.textContent="Сохранить"}),1e3)}))})),P.addEventListener("submit",(function(n){var c,u;n.preventDefault(),L.textContent="Сохранение...",(c=D.value,u=N.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:c,link:u})}).then((function(e){return t(e)}))).then((function(e){var t=o(e,r,J,M);p.prepend(t),a(y),P.reset(),L.classList.add(I.inactiveButtonClass),L.setAttribute("disabled","")})).catch((function(e){console.log("Ошибка выполнения запроса к серверу - ".concat(e))})).finally((function(){setTimeout((function(){L.textContent="Сохранить"}),1e3)}))})),d={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(d.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);i(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(t,e,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.classList.add(o.errorClass),r.textContent=n}(t,e,e.validationMessage,n)}(r,e,t),i(n,o,t)}))}))}(e,d)})),Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:e.authoriseHeader}).then((function(e){return t(e)})),fetch("".concat(e.baseUrl,"/cards"),{headers:e.authoriseHeader}).then((function(e){return t(e)}))]).then((function(e){var t=e[0],n=e[1];T.textContent=t.name,A.textContent=t.about,B.style.backgroundImage="url(".concat(t.avatar,")"),n.forEach((function(e){var n;n=e.owner._id===t._id?o(e,r,J,M):o(e,r,J),e.likes.some((function(e){return e._id===t._id}))&&n.querySelector(".card__like-button").classList.toggle("card__like-button_is-active"),p.append(n)}))}))})();